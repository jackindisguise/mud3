<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta
			http-equiv="Content-Security-Policy"
			content="
				default-src 'self';
				script-src 'self';
				style-src 'self' 'unsafe-inline';
				img-src 'self' data:;
				font-src 'self' data:;
				connect-src 'self';
				media-src 'none';
				object-src 'none';
				base-uri 'self';
				form-action 'self';
				upgrade-insecure-requests;
			"
		/>
		<title>Helpfile Editor</title>
		<link rel="stylesheet" href="./static/dark.css" id="theme-stylesheet" />
		<script src="./static/theme-init.js"></script>
	</head>
	<body>
		<div id="app">
			<header>
				<div class="header-title">
					<h1>Helpfile Editor</h1>
				</div>
				<div class="header-controls">
					<button
						id="theme-toggle-btn"
						class="theme-toggle-btn"
						title="Toggle light/dark mode"
					>
						ðŸŒ™
					</button>
					<button id="help-btn" class="help-btn" title="Show help">?</button>
				</div>
			</header>

			<div class="main-container">
				<!-- Left Sidebar: Helpfile List -->
				<aside class="sidebar left">
					<div class="helpfile-list-container">
						<div class="helpfile-list" id="helpfile-list"></div>
					</div>
					<button class="add-btn" id="add-helpfile-btn">+ Add Helpfile</button>
				</aside>

				<!-- Center: Editor -->
				<main class="map-container">
					<div class="map-area">
						<div
							id="editor-container"
							style="padding: 2rem; overflow-y: auto; height: 100%"
						>
							<div
								id="no-selection"
								style="text-align: center; color: var(--base0); padding: 3rem"
							>
								<p>Select a helpfile from the sidebar to edit it.</p>
							</div>
							<div id="helpfile-editor" style="display: none">
								<form id="helpfile-form" style="max-width: 800px">
									<h2 id="editor-title">Edit Helpfile</h2>

									<div class="form-group">
										<label for="helpfile-keyword">Keyword:</label>
										<input
											type="text"
											id="helpfile-keyword"
											readonly
											style="background: var(--base02); opacity: 0.7"
										/>
										<small
											style="
												color: var(--base0);
												font-size: 0.85rem;
												display: block;
												margin-top: 0.25rem;
											"
										>
											Primary keyword used to access this help file
										</small>
									</div>

									<fieldset
										style="
											border: 1px solid var(--base01);
											padding: 1rem;
											margin: 1rem 0;
											border-radius: 4px;
										"
									>
										<legend>Aliases</legend>
										<div
											id="aliases-tag-input"
											style="
												display: flex;
												flex-wrap: wrap;
												gap: 0.5rem;
												padding: 0.5rem;
												background: var(--base02);
												border: 1px solid var(--base01);
												border-radius: 4px;
												min-height: 2.5rem;
												align-items: center;
											"
										>
											<input
												type="text"
												id="aliases-input"
												placeholder="Type an alias and press Tab"
												style="
													flex: 1;
													min-width: 200px;
													padding: 0.5rem;
													background: transparent;
													border: none;
													color: var(--base1);
													outline: none;
												"
											/>
										</div>
									</fieldset>

									<fieldset
										style="
											border: 1px solid var(--base01);
											padding: 1rem;
											margin: 1rem 0;
											border-radius: 4px;
										"
									>
										<legend>Related</legend>
										<select
											id="related-dropdown"
											style="
												width: 100%;
												padding: 0.5rem;
												background: var(--base02);
												border: 1px solid var(--base01);
												color: var(--base1);
												border-radius: 4px;
												margin-bottom: 0.5rem;
											"
										>
											<option value="">-- Select a helpfile --</option>
										</select>
										<div
											id="related-tag-input"
											style="
												display: flex;
												flex-wrap: wrap;
												gap: 0.5rem;
												padding: 0.5rem;
												background: var(--base02);
												border: 1px solid var(--base01);
												border-radius: 4px;
												min-height: 2.5rem;
												align-items: center;
											"
										></div>
									</fieldset>

									<fieldset
										style="
											border: 1px solid var(--base01);
											padding: 1rem;
											margin: 1rem 0;
											border-radius: 4px;
										"
									>
										<legend>Topics</legend>
										<select
											id="topics-dropdown"
											style="
												width: 100%;
												padding: 0.5rem;
												background: var(--base02);
												border: 1px solid var(--base01);
												color: var(--base1);
												border-radius: 4px;
												margin-bottom: 0.5rem;
											"
										>
											<option value="">-- Select an existing topic --</option>
										</select>
										<div
											id="topics-tag-input"
											style="
												display: flex;
												flex-wrap: wrap;
												gap: 0.5rem;
												padding: 0.5rem;
												background: var(--base02);
												border: 1px solid var(--base01);
												border-radius: 4px;
												min-height: 2.5rem;
												align-items: center;
											"
										>
											<input
												type="text"
												id="topics-input"
												placeholder="Type a topic and press Tab"
												style="
													flex: 1;
													min-width: 200px;
													border: none;
													background: transparent;
													color: var(--base1);
													outline: none;
													font-size: 0.9rem;
													padding: 0.25rem;
												"
											/>
										</div>
									</fieldset>

									<div class="form-group">
										<label for="helpfile-content">Content:</label>
										<textarea
											id="helpfile-content"
											rows="15"
											required
											style="
												width: 100%;
												padding: 0.75rem;
												background: var(--base02);
												border: 1px solid var(--base01);
												color: var(--base1);
												border-radius: 4px;
												font-family: monospace;
												font-size: 0.9rem;
												resize: vertical;
											"
										></textarea>
										<small
											style="
												color: var(--base0);
												font-size: 0.85rem;
												display: block;
												margin-top: 0.25rem;
											"
										>
											Main body text of the help file displayed to players
										</small>
									</div>

									<div class="form-group">
										<label
											style="
												display: block;
												margin-bottom: 0.5rem;
												color: var(--base1);
												font-weight: 500;
											"
										>
											Preview:
										</label>
										<div
											id="helpfile-preview"
											style="
												width: 100%;
												min-height: 300px;
												padding: 0.75rem;
												background: #000;
												border: 1px solid var(--base01);
												border-radius: 4px;
												font-family: 'Courier New', monospace;
												font-size: 0.85rem;
												color: #ccc;
												white-space: pre-wrap;
												overflow-y: auto;
												max-height: 500px;
												line-height: 1.4;
											"
										></div>
									</div>

									<div class="modal-actions" style="margin-top: 2rem">
										<button type="submit" id="save-btn">Save</button>
										<button type="button" id="cancel-btn">Cancel</button>
										<button
											type="button"
											id="delete-btn"
											style="
												background: var(--base02);
												border-color: var(--red);
												color: var(--red);
											"
										>
											Delete
										</button>
									</div>
								</form>
							</div>
						</div>
						<!-- Toast Container -->
						<div id="toast-container" class="toast-container"></div>
					</div>
				</main>
			</div>

			<!-- Modal for creating new helpfile -->
			<div id="new-helpfile-modal" class="modal">
				<div class="modal-content">
					<span class="close" id="new-helpfile-close">&times;</span>
					<h2>Create New Helpfile</h2>
					<div class="form-group">
						<label>Helpfile Keyword:</label>
						<input
							type="text"
							id="new-helpfile-keyword"
							placeholder="my-helpfile"
							pattern="[a-z0-9_-]+"
						/>
						<small
							style="
								color: #aaa;
								font-size: 0.85rem;
								display: block;
								margin-top: 0.25rem;
							"
						>
							Lowercase letters, numbers, hyphens, and underscores only
						</small>
					</div>
					<div class="modal-actions">
						<button id="new-helpfile-create">Create</button>
						<button id="new-helpfile-cancel">Cancel</button>
					</div>
				</div>
			</div>

			<!-- Help modal -->
			<div id="help-modal" class="modal">
				<div class="modal-content help-modal-content">
					<span class="close" id="help-close">&times;</span>
					<h2>Help & Tips</h2>
					<div class="help-content">
						<section class="help-section">
							<h3>Getting Started</h3>
							<ul>
								<li>
									Select a helpfile from the sidebar to edit it, or click
									<strong>"+ Add Helpfile"</strong> to create a new one
								</li>
								<li>
									Click the <strong>Save</strong> button to save your changes
								</li>
								<li>
									Click <strong>Cancel</strong> to discard unsaved changes
								</li>
								<li>
									Click <strong>Delete</strong> to permanently remove a helpfile
								</li>
								<li>
									The <strong>Preview</strong> panel shows how the helpfile will
									appear in-game as you type
								</li>
							</ul>
						</section>

						<section class="help-section">
							<h3>Basic Information</h3>
							<ul>
								<li>
									<strong>Keyword:</strong> Primary keyword used to access this
									helpfile (read-only, set when creating)
								</li>
								<li>
									<strong>Content:</strong> Main body text displayed to players
									when they use the help command
								</li>
								<li>
									Content is displayed in an 80-character box with proper
									formatting and borders
								</li>
							</ul>
						</section>

						<section class="help-section">
							<h3>Aliases</h3>
							<ul>
								<li>
									Aliases are alternative keywords that reference this helpfile
								</li>
								<li>
									Type an alias in the input field and press
									<strong>Tab</strong>
									to create a tag
								</li>
								<li>
									Aliases must be unique across all helpfiles (cannot conflict
									with other helpfile keywords or aliases)
								</li>
								<li>
									Multi-word aliases are supported (e.g., "blood demon art")
								</li>
								<li>
									Click the <strong>Ã—</strong> button on a tag to remove it
								</li>
								<li>
									Press <strong>Backspace</strong> when the input is empty to
									remove the last tag
								</li>
							</ul>
						</section>

						<section class="help-section">
							<h3>Related Helpfiles</h3>
							<ul>
								<li>
									Use the dropdown to select related helpfiles (shows both
									keywords and aliases)
								</li>
								<li>
									Related helpfiles are displayed as tags showing aliases when
									available
								</li>
								<li>
									Click the <strong>Ã—</strong> button on a related tag to remove
									it
								</li>
								<li>
									Related helpfiles help players discover related information
								</li>
							</ul>
						</section>

						<section class="help-section">
							<h3>Topics</h3>
							<ul>
								<li>
									Use the dropdown to select existing topics (shows usage counts
									to help maintain consistency)
								</li>
								<li>
									Type a new topic in the input field and press
									<strong>Tab</strong> to create it
								</li>
								<li>
									Topics are sorted by popularity (most used first) in the
									dropdown
								</li>
								<li>
									Multi-word topics are supported (e.g., "combat abilities")
								</li>
								<li>
									Click the <strong>Ã—</strong> button on a topic tag to remove
									it
								</li>
								<li>
									Press <strong>Backspace</strong> when the input is empty to
									remove the last topic
								</li>
							</ul>
						</section>

						<section class="help-section">
							<h3>Preview</h3>
							<ul>
								<li>
									The preview panel updates in real-time as you type in the
									content field
								</li>
								<li>
									Shows exactly how the helpfile will appear to players in-game
								</li>
								<li>
									Content is wrapped at 76 characters (accounting for borders
									and padding)
								</li>
								<li>
									The keyword is displayed as an uppercase title in a centered
									box header
								</li>
							</ul>
						</section>

						<section class="help-section">
							<h3>Tips</h3>
							<ul>
								<li>
									Changes are tracked automatically - you'll be warned if you
									try to navigate away with unsaved changes
								</li>
								<li>
									Use consistent topic names across helpfiles for better
									organization
								</li>
								<li>
									The topics dropdown shows usage counts to help you choose
									existing topics
								</li>
								<li>
									Aliases allow players to find helpfiles using alternative
									keywords
								</li>
								<li>
									Related helpfiles create a network of connected information
									for players
								</li>
							</ul>
						</section>
					</div>
					<div class="modal-actions">
						<button id="help-close-btn">Close</button>
					</div>
				</div>
			</div>
		</div>

		<script src="./static/vendor/js-yaml.min.js"></script>
		<script type="module" src="./static/app.js"></script>
	</body>
</html>
